<div class="all-mr-container">
  <div class="page-header">
    <div class="header-content">
      <h1>All MR ({{ mrList.length }})</h1>
      <div class="header-actions">
        <button class="create-btn" (click)="createCGReviewRequest()">
          <span class="btn-icon">‚ûï</span>
          Create Review Request
        </button>
      </div>
    </div>
  </div>

  <!-- AG Grid Table -->
  <div class="ag-grid-container" *ngIf="isBrowser && !isLoading && !errorMessage">
    <ag-grid-angular 
      class="ag-theme-alpine modern-grid"
      style="height: 100%; width: 100%; min-height: 600px;"
      [rowData]="rowData" 
      [columnDefs]="colDefs"
      [defaultColDef]="defaultColDef"
      [gridOptions]="gridOptions"
      (rowClicked)="onRowClicked($event)"
      (gridReady)="onGridReady($event)">
    </ag-grid-angular>
  </div>

  <!-- Legacy table - hidden in favor of AG Grid -->
  <div class="table-container" *ngIf="false && !isLoading && !errorMessage" style="display: none;">

    <table class="mr-table">
      <thead>
        <tr>
          <th>MR ID</th>
          <th>Title</th>
          <th>Jira</th>
          <th>MR</th>
          <th>Priority</th>
          <th>Squads</th>
          <th>Status</th>
          <th>Reviewer</th>
          <th>AI Summary</th>
          <th>Refresh</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let mr of mrList" class="mr-row">
          <!-- (click)="viewMRDetails(mr)" -->
          <td>{{ mr.mr || mr.mrId || '-' }}</td>
          <td class="title-cell">{{ mr.title }}</td>
          <td>
            <a *ngIf="mr.jira || mr.jiraLink" [href]="mr.jira || mr.jiraLink" target="_blank" class="jira-link" (click)="$event.stopPropagation()">
              Jira
            </a>
            <span *ngIf="!mr.jira && !mr.jiraLink" class="no-link">-</span>
          </td>
          <td>
            <a *ngIf="mr.thread || mr.webUrl" [href]="mr.thread || mr.webUrl" target="_blank" class="mr-link" (click)="$event.stopPropagation()">
              MR
            </a>
            <span *ngIf="!mr.thread && !mr.webUrl" class="no-link">-</span>
          </td>
          <td>{{ mr.priority || '-' }}</td>
          <td>{{ mr.squads || '-' }}</td>
          <td>
            <span [class]="'status-badge ' + getStatusClass(mr.status)">
              {{ mr.status }}
            </span>
          </td>
          <td>{{ mr.reviewer || mr.author || '-' }}</td>
          <td class="ai-summary-cell">
            <button 
              class="ai-summary-btn" 
              (click)="generateSummary(mr)"
              [disabled]="generatingSummary === mr.id"
              title="Generate AI Summary"
            >
              <span *ngIf="generatingSummary !== mr.id">ü§ñ AI Summary</span>
              <span *ngIf="generatingSummary === mr.id" class="loading">Generating...</span>
            </button>
          </td>
          <td class="refresh-cell">
            <button 
              class="refresh-mr-btn" 
              (click)="refreshSingleMR(mr, $event)"
              [disabled]="refreshingMRId === mr.id"
              title="Refresh MR Data"
            >
              <span *ngIf="refreshingMRId !== mr.id">üîÑ</span>
              <span *ngIf="refreshingMRId === mr.id" class="loading">‚è≥</span>
            </button>
          </td>
          <td class="action-cell">
            <span class="action-text">{{ mr.action }}</span>
            <button 
              class="delete-btn" 
              (click)="deleteMR(mr, $event)"
              title="Delete MR"
            >
              üóëÔ∏è
            </button>
          </td>
        </tr>
        
        <!-- Empty state when no MRs -->
        <tr *ngIf="mrList.length === 0" class="empty-row">
          <td colspan="11" class="empty-cell">
            <div class="empty-state">
              <p>No merge requests found</p>
              <button class="create-btn-secondary" (click)="createCGReviewRequest()">
                Create your Review Request
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading merge requests...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <p>{{ errorMessage }}</p>
    <button (click)="loadAllMRs()" class="retry-btn">Retry</button>
  </div>
</div>
